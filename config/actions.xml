<?xml version="1.0"?>
<actions extends="generic">
	<action name="refreshDashboard">
		<parameter name="listWidget" />
		<body><![CDATA[
			try
			{
				var wrpcontent = new XPCNativeWrapper(this.getElementByAnonId('dashboard_frame').contentWindow).wrappedJSObject;
	   			wrpcontent.Dashboard.refresh();
		    }
		    catch (e)
		    {
		    	wCore.error('refresh', [], e);
		    }
		]]></body>
	</action>

	<action name="editDashboard">
		<parameter name="listWidget" />
		<body><![CDATA[
	    	wCore.debug('dashboard.editDashboard');
	    	var oldUrl = this.getElementByAnonId('designDasboardFrame').getAttribute("src");
	    	
	    	var editUrl = wToolkit.buildXulURL('dashboard', 'EditContent', {lang: Context.W_LANG, uilang: Context.W_UILANG}, true);
	    	var deck = this.getElementByAnonId('pageDeck');
			if (editUrl != oldUrl)
			{
				deck.selectedIndex = 3;
				this.getElementByAnonId('designDasboardFrame').setAttribute("src", editUrl);
			}
			else
			{
				deck.selectedIndex = 1;
			}
			this.getElementByAnonId('dashboard_frame').setAttribute("src", "about:blank");
		]]></body>
	</action>

	<action name="onModuleInit">
		<body><![CDATA[
			try
			{	
				wCore.debug('dashboard.onModuleInit');
				var oldUrl = this.getElementByAnonId('dashboard_frame').getAttribute("src");
				
				wCore.debug('dashboard.onModuleInit oldurl :' + oldUrl);
				var dashboardRegularUrl = wToolkit.buildXulURL('dashboard', 'Dashboard', {lang: Context.W_LANG, uilang: Context.W_UILANG}, 'html');
				
				wCore.debug('dashboard.onModuleInit RegularUrl :' + dashboardRegularUrl);
				if (oldUrl != dashboardRegularUrl)
				{	
					wCore.debug('dashboard.onModuleInit setSrc' + dashboardRegularUrl);	    
			    	this.getElementByAnonId('dashboard_frame').setAttribute("src", dashboardRegularUrl);
			    }
			    
				var deck = this.getElementByAnonId('pageDeck');
				wCore.debug('dashboard.onModuleInit deck');
				
				deck.selectedIndex = 0;
				wCore.debug('dashboard.onModuleInit selectedIndex');
			
		    }
		    catch (e)
		    {
		    	wCore.error('onModuleInit', [], e);
		    }
		]]></body>
	</action>

	<action name="onLoadAction" label="onLoadAction">
		<body><![CDATA[
			wCore.debug('dashboard.onLoadAction');
			this.onModuleInit();
		]]></body>
	</action>

	<action name="onSwitchFrom" label="">
		<parameter name="fromModule" />
		<body><![CDATA[
			wCore.debug('onSwitchFrom : ' + fromModule);
			this.refreshDashboard();
		]]></body>
	</action>
</actions>